{"ast":null,"code":"import _toConsumableArray from\"/Users/yamazakikouji/Desktop/ec-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/yamazakikouji/Desktop/ec-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yamazakikouji/Desktop/ec-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useCallback}from'react';import IconButton from'@material-ui/core/IconButton';import AddPhotoAlternateIcon from'@material-ui/icons/AddPhotoAlternate';import{makeStyles}from'@material-ui/core';import{storage}from'../../firebase/index';import ImagePreview from'./imagePreview';var useStyles=makeStyles({icon:{height:48,width:48}});var ImageArea=function ImageArea(props){var classes=useStyles();var deleteImage=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var ret,newImages;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:ret=window.confirm('この画像を削除しますか？');if(ret){_context.next=5;break;}return _context.abrupt(\"return\",false);case 5:newImages=props.images.filter(function(image){return image.id!==id;});props.setImages(newImages);return _context.abrupt(\"return\",storage.ref('images').child(id).delete());case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}(),[props]);//props.images, を入れてた。\nvar uploadImage=useCallback(function(event){var file=event.target.files;var blob=new Blob(file,{type:\"image/jpeg\"});// Generate random 16 digits strings\nvar S=\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";var N=16;var fileName=Array.from(crypto.getRandomValues(new Uint32Array(N))).map(function(n){return S[n%S.length];}).join('');var uploadRef=storage.ref('images').child(fileName);var uploadTask=uploadRef.put(blob);uploadTask.then(function(){// Handle successful uploads on complete\nuploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL){var newImage={id:fileName,path:downloadURL};props.setImages(function(prevState){return[].concat(_toConsumableArray(prevState),[newImage]);});});});},[props]);//props.setImages, を入れてた。\nreturn/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"p-grid__list-images\"},props.images.length>0&&props.images.map(function(image){return/*#__PURE__*/React.createElement(ImagePreview,{id:image.id,delete:deleteImage,path:image.path,key:image.id});})),/*#__PURE__*/React.createElement(\"div\",{className:\"u-text-right\"},/*#__PURE__*/React.createElement(\"span\",null,\"\\u5546\\u54C1\\u753B\\u50CF\\u3092\\u767B\\u9332\\u3059\\u308B\"),/*#__PURE__*/React.createElement(IconButton,{className:classes.icon},/*#__PURE__*/React.createElement(\"label\",null,/*#__PURE__*/React.createElement(AddPhotoAlternateIcon,null),/*#__PURE__*/React.createElement(\"input\",{className:\"u-display-none\",type:\"file\",id:\"image\",onChange:function onChange(event){return uploadImage(event);}})))));};export default ImageArea;","map":{"version":3,"sources":["/Users/yamazakikouji/Desktop/ec-app/src/components/Products/imageArea.jsx"],"names":["React","useCallback","IconButton","AddPhotoAlternateIcon","makeStyles","storage","ImagePreview","useStyles","icon","height","width","ImageArea","props","classes","deleteImage","id","ret","window","confirm","newImages","images","filter","image","setImages","ref","child","delete","uploadImage","event","file","target","files","blob","Blob","type","S","N","fileName","Array","from","crypto","getRandomValues","Uint32Array","map","n","length","join","uploadRef","uploadTask","put","then","snapshot","getDownloadURL","downloadURL","newImage","path","prevState"],"mappings":"mdAAA,MAAOA,CAAAA,KAAP,EAAeC,WAAf,KAAiC,OAAjC,CACA,MAAOC,CAAAA,UAAP,KAAuB,8BAAvB,CACA,MAAOC,CAAAA,qBAAP,KAAkC,sCAAlC,CACA,OAASC,UAAT,KAA2B,mBAA3B,CACA,OAASC,OAAT,KAAwB,sBAAxB,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CAEA,GAAMC,CAAAA,SAAS,CAAGH,UAAU,CAAC,CACzBI,IAAI,CAAE,CACFC,MAAM,CAAE,EADN,CAEFC,KAAK,CAAE,EAFL,CADmB,CAAD,CAA5B,CAOA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAACC,KAAD,CAAW,CACzB,GAAMC,CAAAA,OAAO,CAAGN,SAAS,EAAzB,CAEA,GAAMO,CAAAA,WAAW,CAAGb,WAAW,0FAAC,iBAAOc,EAAP,oIACtBC,GADsB,CAChBC,MAAM,CAACC,OAAP,CAAe,cAAf,CADgB,IAEvBF,GAFuB,yDAGjB,KAHiB,SAKlBG,SALkB,CAKNP,KAAK,CAACQ,MAAN,CAAaC,MAAb,CAAoB,SAAAC,KAAK,QAAIA,CAAAA,KAAK,CAACP,EAAN,GAAaA,EAAjB,EAAzB,CALM,CAMxBH,KAAK,CAACW,SAAN,CAAgBJ,SAAhB,EANwB,gCAOjBd,OAAO,CAACmB,GAAR,CAAY,QAAZ,EAAsBC,KAAtB,CAA4BV,EAA5B,EAAgCW,MAAhC,EAPiB,wDAAD,+DAS5B,CAACd,KAAD,CAT4B,CAA/B,CAUI;AAGJ,GAAMe,CAAAA,WAAW,CAAG1B,WAAW,CAAC,SAAC2B,KAAD,CAAW,CACvC,GAAMC,CAAAA,IAAI,CAAGD,KAAK,CAACE,MAAN,CAAaC,KAA1B,CACA,GAAIC,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,CAASJ,IAAT,CAAe,CAAEK,IAAI,CAAE,YAAR,CAAf,CAAX,CAEA;AACA,GAAMC,CAAAA,CAAC,CAAE,gEAAT,CACA,GAAMC,CAAAA,CAAC,CAAE,EAAT,CACA,GAAMC,CAAAA,QAAQ,CAAGC,KAAK,CAACC,IAAN,CAAWC,MAAM,CAACC,eAAP,CAAuB,GAAIC,CAAAA,WAAJ,CAAgBN,CAAhB,CAAvB,CAAX,EAAuDO,GAAvD,CAA2D,SAACC,CAAD,QAAKT,CAAAA,CAAC,CAACS,CAAC,CAACT,CAAC,CAACU,MAAL,CAAN,EAA3D,EAA+EC,IAA/E,CAAoF,EAApF,CAAjB,CAEA,GAAMC,CAAAA,SAAS,CAAG1C,OAAO,CAACmB,GAAR,CAAY,QAAZ,EAAsBC,KAAtB,CAA4BY,QAA5B,CAAlB,CACA,GAAMW,CAAAA,UAAU,CAAGD,SAAS,CAACE,GAAV,CAAcjB,IAAd,CAAnB,CAEAgB,UAAU,CAACE,IAAX,CAAgB,UAAM,CAClB;AACAF,UAAU,CAACG,QAAX,CAAoB3B,GAApB,CAAwB4B,cAAxB,GAAyCF,IAAzC,CAA8C,SAACG,WAAD,CAAiB,CAC3D,GAAMC,CAAAA,QAAQ,CAAG,CAACvC,EAAE,CAAEsB,QAAL,CAAekB,IAAI,CAAEF,WAArB,CAAjB,CACAzC,KAAK,CAACW,SAAN,CAAiB,SAAAiC,SAAS,qCAAQA,SAAR,GAAmBF,QAAnB,IAA1B,EACH,CAHD,EAIH,CAND,EAOH,CAnB8B,CAmB5B,CAAC1C,KAAD,CAnB4B,CAA/B,CAoBI;AACJ,mBACI,4CACI,2BAAK,SAAS,CAAC,qBAAf,EACKA,KAAK,CAACQ,MAAN,CAAayB,MAAb,CAAsB,CAAtB,EACGjC,KAAK,CAACQ,MAAN,CAAauB,GAAb,CAAiB,SAAArB,KAAK,qBAAI,oBAAC,YAAD,EAAc,EAAE,CAAEA,KAAK,CAACP,EAAxB,CAA4B,MAAM,CAAED,WAApC,CAAiD,IAAI,CAAEQ,KAAK,CAACiC,IAA7D,CAAmE,GAAG,CAAEjC,KAAK,CAACP,EAA9E,EAAJ,EAAtB,CAFR,CADJ,cAMI,2BAAK,SAAS,CAAC,cAAf,eACI,yFADJ,cAEI,oBAAC,UAAD,EAAY,SAAS,CAAEF,OAAO,CAACL,IAA/B,eACI,8CACI,oBAAC,qBAAD,MADJ,cAEI,6BACI,SAAS,CAAC,gBADd,CAC+B,IAAI,CAAC,MADpC,CAC2C,EAAE,CAAC,OAD9C,CAEI,QAAQ,CAAE,kBAACoB,KAAD,QAAWD,CAAAA,WAAW,CAACC,KAAD,CAAtB,EAFd,EAFJ,CADJ,CAFJ,CANJ,CADJ,CAqBH,CA1DD,CA4DA,cAAejB,CAAAA,SAAf","sourcesContent":["import React, {useCallback} from 'react';\nimport IconButton from '@material-ui/core/IconButton';\nimport AddPhotoAlternateIcon from '@material-ui/icons/AddPhotoAlternate';\nimport { makeStyles } from '@material-ui/core';\nimport { storage } from '../../firebase/index';\nimport ImagePreview from './imagePreview';\n\nconst useStyles = makeStyles({\n    icon: {\n        height: 48,\n        width: 48\n    }\n})\n\nconst ImageArea = (props) => {\n    const classes = useStyles();\n\n    const deleteImage = useCallback(async (id) => {\n        const ret = window.confirm('この画像を削除しますか？')\n        if (!ret) {\n            return false\n        } else {\n            const newImages = props.images.filter(image => image.id !== id)\n            props.setImages(newImages);\n            return storage.ref('images').child(id).delete()\n        }\n    }, [props])\n        //props.images, を入れてた。\n\n\n    const uploadImage = useCallback((event) => {\n        const file = event.target.files;\n        let blob = new Blob(file, { type: \"image/jpeg\" });\n    \n        // Generate random 16 digits strings\n        const S =\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n        const N =16;\n        const fileName = Array.from(crypto.getRandomValues(new Uint32Array(N))).map((n)=>S[n%S.length]).join('')\n    \n        const uploadRef = storage.ref('images').child(fileName);\n        const uploadTask = uploadRef.put(blob);\n    \n        uploadTask.then(() => {\n            // Handle successful uploads on complete\n            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {\n                const newImage = {id: fileName, path: downloadURL};\n                props.setImages((prevState => [...prevState, newImage]))\n            });\n        })\n    }, [props]);\n        //props.setImages, を入れてた。\n    return(\n        <div>\n            <div className=\"p-grid__list-images\">\n                {props.images.length > 0 && (\n                    props.images.map(image => <ImagePreview id={image.id} delete={deleteImage} path={image.path} key={image.id} />)\n                )}\n            </div>\n            <div className=\"u-text-right\">\n                <span>商品画像を登録する</span>\n                <IconButton className={classes.icon}>\n                    <label>\n                        <AddPhotoAlternateIcon />\n                        <input \n                            className=\"u-display-none\" type=\"file\" id=\"image\" \n                            onChange={(event) => uploadImage(event)}\n                        />\n                    </label>\n                </IconButton>\n            </div>\n        </div>\n    )\n};\n\nexport default ImageArea;"]},"metadata":{},"sourceType":"module"}